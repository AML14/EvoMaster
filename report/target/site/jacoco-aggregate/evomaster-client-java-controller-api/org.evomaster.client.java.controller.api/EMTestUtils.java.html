<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>EMTestUtils.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">evomaster-project-report</a> &gt; <a href="../index.html" class="el_bundle">evomaster-client-java-controller-api</a> &gt; <a href="index.source.html" class="el_package">org.evomaster.client.java.controller.api</a> &gt; <span class="el_source">EMTestUtils.java</span></div><h1>EMTestUtils.java</h1><pre class="source lang-java linenums">package org.evomaster.client.java.controller.api;

/*
    Note: this class is in this module, as to make sure that the exact same code
    is used in the EvoMaster Core (eg, when making HTTP calls) and
    as well in the generated tests

    WARNING: if you change any method name/signature, need to make sure that
    the code generation is updated as well
 */

import java.net.URI;

/**
 * Class containing utility functions that can be used in the
 * automatically generated tests
 */
<span class="nc" id="L18">public class EMTestUtils {</span>

    /**
     *
     * @param locationHeader a URI-reference, coming from a &quot;location&quot; header. See RFC 7231.
     *                       Note: it can be a relative reference
     * @param expectedTemplate a full URI of the target resource, but with some path elements
     *                         that might be unresolved. If {@code locationHeader} is not
     *                         empty, it will replace the beginning of this template.
     * @return a fully resolved URI for the target resource. If there are problems, just
     *          return the input locationHeader
     */
    public static String resolveLocation(String locationHeader, String expectedTemplate){

        URI locationURI;
        try{
<span class="nc" id="L34">            locationURI = URI.create(locationHeader);</span>
<span class="nc" id="L35">        } catch (Exception e){</span>
<span class="nc" id="L36">            return locationHeader;</span>
<span class="nc" id="L37">        }</span>
<span class="nc" id="L38">        String locationPath = locationURI.getPath();</span>
<span class="nc" id="L39">        String[] locationTokens = locationPath.split(&quot;/&quot;);</span>


        //the template is not a valid URL, due to {}
<span class="nc" id="L43">        String normalizedTemplate = expectedTemplate.replace(&quot;{&quot;,&quot;&quot;).replace(&quot;}&quot;,&quot;&quot;);</span>
<span class="nc" id="L44">        URI templateURI = URI.create(normalizedTemplate);</span>
<span class="nc" id="L45">        String templatePath = templateURI.getPath();</span>
<span class="nc" id="L46">        String[] templateTokens = templatePath.split(&quot;/&quot;);</span>


<span class="nc" id="L49">        String targetPath = locationPath;</span>

<span class="nc bnc" id="L51" title="All 2 branches missed.">        if(templateTokens.length &gt; locationTokens.length){</span>
            /*
                This is to handle cases like:

                POST /elements
                PUT  /elements/{id}/x

                where the location header of POST does point to

                /elements/{id}

                and not directly to &quot;x&quot;
             */

<span class="nc bnc" id="L65" title="All 2 branches missed.">            for(int i=locationTokens.length; i &lt; templateTokens.length; i++){</span>
<span class="nc" id="L66">                targetPath += &quot;/&quot; + templateTokens[i];</span>
            }
        }


        URI targetURI;

        try {
<span class="nc bnc" id="L74" title="All 4 branches missed.">            if (locationURI.isAbsolute() || locationURI.getHost() != null) {</span>

<span class="nc" id="L76">                targetURI = new URI(</span>
<span class="nc" id="L77">                        locationURI.getScheme(),</span>
<span class="nc" id="L78">                        locationURI.getUserInfo(),</span>
<span class="nc" id="L79">                        locationURI.getHost(),</span>
<span class="nc" id="L80">                        locationURI.getPort(),</span>
                        targetPath,
<span class="nc" id="L82">                        locationURI.getQuery(),</span>
<span class="nc" id="L83">                        locationURI.getFragment());</span>

            } else {
<span class="nc" id="L86">                targetURI = new URI(</span>
<span class="nc" id="L87">                        templateURI.getScheme(),</span>
<span class="nc" id="L88">                        templateURI.getUserInfo(),</span>
<span class="nc" id="L89">                        templateURI.getHost(),</span>
<span class="nc" id="L90">                        templateURI.getPort(),</span>
                        targetPath,
<span class="nc" id="L92">                        templateURI.getQuery(),</span>
<span class="nc" id="L93">                        templateURI.getFragment());</span>
            }
<span class="nc" id="L95">        }catch (Exception e){</span>
            //shouldn't really happen
<span class="nc" id="L97">            throw new RuntimeException(e);</span>
<span class="nc" id="L98">        }</span>

<span class="nc" id="L100">        return targetURI.toString();</span>
    }


    /**
     * Check if the given input string is a valid URI
     * @param uri
     * @return
     */
    public static boolean isValidURIorEmpty(String uri){

<span class="nc bnc" id="L111" title="All 4 branches missed.">        if(uri == null || uri.trim().isEmpty()){</span>
<span class="nc" id="L112">            return true;</span>
        }

        try{
<span class="nc" id="L116">            URI.create(uri);</span>
<span class="nc" id="L117">            return true;</span>
<span class="nc" id="L118">        }catch (Exception e){</span>
<span class="nc" id="L119">            return false;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>